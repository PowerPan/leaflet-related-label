/*! leaflet-related-label 2016-11-18 Copyright by   */
L.RelatedLabel=L.Layer.extend({includes:L.Mixin.Events,options:{className:"",clickable:!1,direction:"right",offset:[12,-15],opacity:.9,zoomAnimation:!0},initialize:function(a,b,c){L.setOptions(this,c),this._related=a,this._parrent=b,this._animated=L.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1,this.setLatLng(this._related.getLatLng()),this._related.on("move",this._relatedMove,this)},onAdd:function(a){return!!a.hasLayer(this._related)&&(this._map=a,this._pane=this.options.pane?a._panes[this.options.pane]:this._related instanceof L.Marker?a._panes.markerPane:a._panes.popupPane,this._container||this._initLayout(),this._pane.appendChild(this._container),this._initInteraction(),this._update(),this.setOpacity(this.options.opacity),a.on("moveend",this._onMoveEnd,this).on("viewreset",this._onViewReset,this),this._related.on("add",this._relatedAdd,this),this._related.on("remove",this._relatedRemove,this),void(this._animated&&a.on("zoomanim",this._zoomAnimation,this)))},_relatedMove:function(a){this.setLatLng(a.target.getLatLng())},_relatedAdd:function(a){this.isOnMap()||a.target._map.hasLayer(this._parrent)&&this.onAdd(a.target._map)},_relatedRemove:function(a){this.onRemove(this._map)},_layerAdd:function(a,b){this.onAdd(a.target)},isOnMap:function(){return!!this._map},onRemove:function(a){return!!this.isOnMap()&&(this._related.off("remove",this._relatedRemove,this),this._pane.removeChild(this._container),a.off({zoomanim:this._zoomAnimation,moveend:this._onMoveEnd,viewreset:this._onViewReset},this),this._removeInteraction(),void(this._map=null))},setLatLng:function(a){return this._latlng=L.latLng(a),this._map&&this._updatePosition(),this},setContent:function(a){return this._previousContent=this._content,this._content=a,this._updateContent(),this},updateZIndex:function(a){this._zIndex=a,this._container&&this._zIndex&&(this._container.style.zIndex=a)},setOpacity:function(a){this.options.opacity=a,this._container&&L.DomUtil.setOpacity(this._container,a)},_initLayout:function(){this._container=L.DomUtil.create("div","leaflet-related-label "+this.options.className+" leaflet-zoom-animated"),this.updateZIndex(this._zIndex)},_update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updatePosition(),this._container.style.visibility="")},_updateContent:function(){this._content&&this._map&&this._prevContent!==this._content&&"string"==typeof this._content&&(this._container.innerHTML=this._content,this._prevContent=this._content,this._labelWidth=this._container.offsetWidth)},_updatePosition:function(){var a=this._map.latLngToLayerPoint(this._latlng);this._setPosition(a)},_setPosition:function(a){var b=this._map,c=this._container,d=b.latLngToContainerPoint(b.getCenter()),e=b.layerPointToContainerPoint(a),f=this.options.direction,g=this._labelWidth,h=L.point(this.options.offset);"right"===f||"auto"===f&&e.x<d.x?(L.DomUtil.addClass(c,"leaflet-related-label-right"),L.DomUtil.removeClass(c,"leaflet-related-label-left"),a=a.add(h)):(L.DomUtil.addClass(c,"leaflet-related-label-left"),L.DomUtil.removeClass(c,"leaflet-related-label-right"),a=a.add(L.point(-h.x-g,h.y))),L.DomUtil.setPosition(c,a)},_zoomAnimation:function(a){var b=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center).round();this._setPosition(b)},_onMoveEnd:function(){this._animated&&"auto"!==this.options.direction||this._updatePosition()},_onViewReset:function(a){a&&a.hard&&this._update()},_initInteraction:function(){if(this.options.clickable){var a=this._container,b=["dblclick","mousedown","mouseover","mouseout","contextmenu"];L.DomUtil.addClass(a,"leaflet-clickable"),L.DomEvent.on(a,"click",this._onMouseClick,this);for(var c=0;c<b.length;c++)L.DomEvent.on(a,b[c],this._fireMouseEvent,this)}},_removeInteraction:function(){if(this.options.clickable){var a=this._container,b=["dblclick","mousedown","mouseover","mouseout","contextmenu"];L.DomUtil.removeClass(a,"leaflet-clickable"),L.DomEvent.off(a,"click",this._onMouseClick,this);for(var c=0;c<b.length;c++)L.DomEvent.off(a,b[c],this._fireMouseEvent,this)}},_onMouseClick:function(a){this.hasEventListeners(a.type)&&L.DomEvent.stopPropagation(a),this.fire(a.type,{originalEvent:a})},_fireMouseEvent:function(a){this.fire(a.type,{originalEvent:a}),"contextmenu"===a.type&&this.hasEventListeners(a.type)&&L.DomEvent.preventDefault(a),"mousedown"!==a.type?L.DomEvent.stopPropagation(a):L.DomEvent.preventDefault(a)}});